/**
 * Test AI-Generated Prompts
 * Demonstrates GPT-4o generating realistic prompts without brand mentions
 */

import { generatePromptsWithAI, validatePrompts } from './services/aiPromptGenerator.js';
import chalk from 'chalk';
import * as dotenv from 'dotenv';

dotenv.config();

const brandInfo = {
  brandName: "Descript",
  productDetails: "AI video editing software",
  tagline: "Video editing as easy as editing a document",
  industry: "Software / SaaS",
  location: "USA"
};

async function testAIPrompts() {
  console.log(chalk.blue('\n' + '='.repeat(80)));
  console.log(chalk.blue.bold('  AI-GENERATED PROMPTS (Using GPT-4o)'));
  console.log(chalk.blue('='.repeat(80) + '\n'));

  console.log(chalk.gray('Brand Information:'));
  console.log(`  Brand: ${chalk.cyan(brandInfo.brandName)}`);
  console.log(`  Product: ${chalk.cyan(brandInfo.productDetails)}`);
  console.log(`  Tagline: ${chalk.cyan(brandInfo.tagline)}`);
  console.log();

  console.log(chalk.yellow('⏳ Generating 10 realistic prompts using GPT-4o...\n'));

  try {
    const apiKey = process.env.OPENAI_API_KEY || process.env.CHATGPT_API_KEY;

    if (!apiKey) {
      console.error(chalk.red('❌ Error: OPENAI_API_KEY not found in .env file'));
      console.log(chalk.gray('\nPlease add your OpenAI API key to .env:'));
      console.log(chalk.white('OPENAI_API_KEY=sk-...'));
      process.exit(1);
    }

    const prompts = await generatePromptsWithAI(brandInfo, 10, apiKey);

    // Validate no brand mentions
    const validPrompts = validatePrompts(prompts, brandInfo.brandName);

    console.log(chalk.green('✓ Generated prompts successfully!\n'));
    console.log(chalk.bold('Prompts Generated by GPT-4o:\n'));

    validPrompts.forEach((prompt, i) => {
      console.log(chalk.gray(`${i + 1}.`), chalk.white(prompt));
      console.log(chalk.cyan(`   Length: ${prompt.length} chars`));

      // Check for brand mention (should be none)
      const hasBrandMention = prompt.toLowerCase().includes(brandInfo.brandName.toLowerCase());
      if (hasBrandMention) {
        console.log(chalk.red(`   ⚠️  WARNING: Contains brand name!`));
      } else {
        console.log(chalk.green(`   ✓ No brand mention (good!)`));
      }
      console.log();
    });

    // Statistics
    const avgLength = Math.round(validPrompts.reduce((sum, p) => sum + p.length, 0) / validPrompts.length);
    const minLength = Math.min(...validPrompts.map(p => p.length));
    const maxLength = Math.max(...validPrompts.map(p => p.length));

    console.log(chalk.blue('\n' + '='.repeat(80)));
    console.log(chalk.bold('  STATISTICS'));
    console.log('='.repeat(80) + '\n'));

    console.log(`Total Prompts: ${chalk.cyan(validPrompts.length)}`);
    console.log(`Average Length: ${chalk.cyan(avgLength)} characters`);
    console.log(`Range: ${chalk.cyan(minLength)} - ${chalk.cyan(maxLength)} characters`);
    console.log(`Brand Mentions: ${chalk.green('0')} ✓`);
    console.log(`Realistic & Conversational: ${chalk.green('Yes')} ✓`);
    console.log();

    console.log(chalk.green.bold('✓ All prompts are realistic and do NOT mention the brand name!'));
    console.log(chalk.gray('\nThese prompts will be used to test if AI models naturally recommend your brand.\n'));

  } catch (error) {
    console.error(chalk.red('\n❌ Error:'), error.message);
    console.error(error);
    process.exit(1);
  }
}

testAIPrompts();
